<view class="page-container">
  <!-- 可滚动的表格区域 -->
  <scroll-view class="table-container" scroll-y>
    <view class="table">
      <view class="table-header">
        <view class="cell">商品名</view>
        <view class="cell">总价</view>
        <view class="cell">规格</view>
        <view class="cell">数量</view>
        <view class="cell">单价</view>
      </view>
      <block wx:for="{{items}}" wx:key="index">
        <view class="table-row {{item.error ? 'error' : ''}} {{item.isLowest ? 'lowest' : ''}} {{item.isHighest ? 'highest' : ''}}">
          <view class="cell">
            <input class="input {{!item.nameModified ? 'placeholder-text' : ''}}" 
                   value="{{item.name}}" 
                   data-index="{{index}}" 
                   data-field="name" 
                   bindinput="updateItem" />
          </view>
          <view class="cell">
            <input class="input {{!item.priceModified ? 'placeholder-text' : ''}}" 
                   type="digit" 
                   value="{{item.price}}" 
                   data-index="{{index}}" 
                   data-field="price" 
                   bindinput="updateItem" />
            <icon wx:if="{{item.price && isNaN(item.price)}}" type="warn" size="20" color="red" />
          </view>
          <view class="cell">
            <input class="input {{!item.specModified ? 'placeholder-text' : ''}}" 
                   type="digit" 
                   value="{{item.spec}}" 
                   data-index="{{index}}" 
                   data-field="spec" 
                   bindinput="updateItem" />
            <icon wx:if="{{item.spec && isNaN(item.spec)}}" type="warn" size="20" color="red" />
          </view>
          <view class="cell">
            <input class="input {{!item.quantityModified ? 'placeholder-text' : ''}}" 
                   type="number" 
                   value="{{item.quantity}}" 
                   data-index="{{index}}" 
                   data-field="quantity" 
                   bindinput="updateItem" />
          </view>
          <view class="cell">{{item.unitPrice}}</view>
        </view>
      </block>
    </view>
  </scroll-view>

  <!-- 固定在底部的按钮区域 -->
  <view class="bottom-buttons">
    <view class="action-buttons">
      <button bindtap="addItem">添加商品</button>
      <button bindtap="clearItems">清空</button>
      <button bindtap="toggleManage">{{isManaging ? '完成' : '管理'}}</button>
    </view>
    <view class="manage-buttons" wx:if="{{isManaging}}">
      <button bindtap="selectAll">全选</button>
      <button bindtap="deleteSelectedItems">删除选中</button>
    </view>
    <view class="save-button">
      <button bindtap="saveRecord">保存比价记录</button>
    </view>
  </view>
</view>
